---
title: "ADS Kelompok 6"
output: html_document
date: "2025-11-27"
---

1.  IMPORT DATA

    ```{r}
    data <- read.csv("C:/Users/MyBook Hype AMD/Downloads/Dataset Tugas Besar ADS 2025 - Karakteristik Mahasiswa .csv")
    ```

2.  CEK STRUKTUR DATA

    ```{r}
    str(data)
    summary(data)
    head(data)
    ```

3.  PEMBERSIHAN DATA DAN UBAH NAMA COLOM AGAR LEBIH MUDAH DAN KOVERIS TIPE DATA YANG HARUSNYA NUMERIK

    ```{r}
    library(dplyr)
    library(stringr)
    library(readr)
    #mengganti nama colom
    nama_baru <- c(
      "nim", "prodi", "ipk", "gender", "tinggi", "berat", "pendidikan", 
      "jam_belajar", "beasiswa", "asal_daerah", "pekerjaan", "internet", 
      "organisasi", "uang_saku", "tempat_tinggal", "jarak", "ayah", "ibu", 
      "pendapatan", "keluarga"
    )

      colnames(data) <- nama_baru
    # FUNGSI PEMBERSIH ANGKA
    clean_mixed_numeric <- function(x) {
      x <- as.character(x)
      # Hapus teks 'jam', ganti koma jadi titik, hapus spasi
      x <- str_remove_all(str_to_lower(x), "jam|hours")
      x <- str_replace_all(x, ",", ".")
      x <- str_remove_all(x, "\\s")
      # Ambil angka saja
      num <- str_extract(x, "[0-9]+(\\.[0-9]+)?")
      return(as.numeric(num))
    }

    #BERSIHKAN DATA
    data_clean <- data %>%
      mutate(
        # Bersihkan kolom angka
        ipk = clean_mixed_numeric(ipk),
        jam_belajar = clean_mixed_numeric(jam_belajar),
        tinggi = as.numeric(tinggi),
        berat = as.numeric(berat),
        
        # Rapikan teks (Title Case & Hapus Spasi) pada semua kolom teks
        across(where(is.character), ~ str_to_title(str_trim(.))),
        
        # Ubah "-" atau kosong jadi NA
        across(where(is.character), ~ na_if(., "-")),
        across(where(is.character), ~ na_if(., "")),
        
        # Standardisasi Nama Prodi
        prodi = str_replace(prodi, "Sains Data.*", "Sains Data")
      ) %>%
      distinct() # Hapus duplikat
    data_clean <- data_clean %>%
      filter(ipk >= 0 & ipk <= 4)

    #Konversi tipe data yang seharusnya numerik
    num_vars <- c("ipk", "tinggi", "berat", "jam_belajar")

    data_clean[num_vars] <- lapply(data_clean[num_vars], as.numeric)
    # menghapus data yang tidak ada ipk
    data_clean <- data_clean[!is.na(data_clean$ipk), ]
    ```

4.  Uji normalitas

    ```{r}
    library(MASS)
    stdres <- stdres(model)
    stdr <- data.frame(stdres)
    stdr
    sapiro <- shapiro.test(stdres)
    p_value <- sapiro$p.value
    alpha <- 0.05
    if(p_value < alpha){
      cat("Data tidak terdistribusi normal")
    }else{
      cat("Data terdistribusi normal")
    }
    ```

5.  Uji Heteroskedastisitas

    ```{r}
    library(lmtest)
    skeditas <- bptest(model)
    skeditas
    P_value <- skeditas$p.value
    alpha <- 0.05
    if(p_value < alpha){
      cat("ada heteroskedastisitas")
    }else{
      cat("tiadk ada heteroskedastisitas")
    }
    ```

6.  Uji multikolinearitas

    ```{r}
    library(car)
    mlt <- vif(model)
    if(all(mlt < 10)){
       cat("Tidak ada multikolinearitas")
    }else{
       cat("ada multikolinearitas")
    }
    ```

    ```{r}
    head(data_clean)
    ```

7.  Korelasi

    ```{r}
    library(dplyr)
    library(ggcorrplot)
    num_data <- data_clean[num_vars]
    num_data <- num_data[rowSums(is.na(num_data)) != length(num_vars), ]
    num_data <- data_clean %>% select(all_of(num_vars))
    corr_matrix <- cor(num_data, use = "pairwise.complete.obs")

    ggcorrplot(
     corr_matrix,
      
      type = "lower",
      lab = TRUE,
      ggtheme = ggplot2::theme_minimal(),
      colors = c("#6D9EC1", "white", "#E46726")
    )
    ```

    8.  REGRESI LINEAR

        ```{r}
        model <- lm(ipk ~ jam_belajar + tinggi + berat  , data = data_clean)

        summary(model)
        # Prediksi menggunakan model, secara otomatis hanya untuk baris yang tidak ada NA
        prediksi <- predict(model)

        # Gunakan data yang sesuai
        data_model <- na.omit(data_clean[, c("ipk", "jam_belajar", "tinggi", "berat")])

        plot(data_model$ipk, prediksi,
             main = "Prediksi vs Aktual IPK",
             xlab = "IPK Aktual",
             ylab = "IPK Prediksi",
             pch = 19, col = "#6D9EC1")
        abline(0, 1, col = "#E46726", lwd = 2)
        grid()
        ```

        ```{r}
        library(ggplot2)

        # Ambil koefisien dari model regresi
        koef <- summary(model)$coefficients

        # Buat data frame untuk plot
        coef_df <- data.frame(
          Variabel = rownames(koef)[-1],  # Hapus Intercept
          Estimate = koef[-1, "Estimate"],
          p_value = koef[-1, "Pr(>|t|)"]
        )

        # Tambahkan kolom signifikan
        coef_df$Signif <- ifelse(coef_df$p_value < 0.05, "Signifikan", "Tidak Signifikan")

        # Plot batang horizontal
        ggplot(coef_df, aes(x = Variabel, y = Estimate, fill = Signif)) +
          geom_bar(stat = "identity", width = 0.5) +
          geom_text(aes(label = round(Estimate, 3)), hjust = -0.1) +  # angka di sisi kanan batang
          scale_fill_manual(values = c("Signifikan" = "steelblue", "Tidak Signifikan" = "grey")) +
          labs(title = "Koefisien Regresi Linear Berganda",
               x = "Variabel",
               y = "Koefisien") +
          theme_minimal() +
          coord_flip()  # Membalik sumbu agar horizontal


        summary_model <- summary(model)
        coef_val <- summary_model$coefficients[-1, 1]     # Estimate
        p_val    <- summary_model$coefficients[-1, 4]     # P-value

        # Klasifikasi signifikan atau tidak
        significance <- ifelse(p_val <= 0.05, "Signifikan", "Tidak Signifikan")

        # Warna berdasarkan signifikansi
        bar_colors <- ifelse(significance == "Signifikan", "forestgreen", "grey60")

        # Barplot
        barplot(coef_val,
                main = "Barplot Koefisien Regresi dengan Signifikansi",
                ylab = "Estimate",
                xlab = "Variabel Prediktor",
                col = bar_colors,
                ylim = c(min(coef_val)-0.01, max(coef_val)+0.01)
        )
        abline(h=0, lwd=2)

        # Tambahkan label signifikan / tidak signifikan pada batang
        text(x = 1:length(coef_val),
             y = coef_val,
             labels = significance,
             pos = ifelse(coef_val>0,3,1),
             col = bar_colors,
             font = 2)
        ```
